# 圈选接口文档

```
文档版本: 1.0.0
文档分类：技术部-设计文档
作 者: 赵 鑫
联系电话：13701326552
电子邮件：xin.zhao@datatist.com
```

> 注：${HTTP_HOST}为调用的地址的scheme和域名
目前：测试环境的地址为：http://test.analyzer.datatist.cn，生产环境的地址是：https://analyzer.datatist.com

### token登录

* url:
    * ${HTTP_HOST}/analyzer/authtoken/login.json
* method:
    * GET
* query params:
    * token
* 示例

```js
请求示例：
${HTTP_HOST}/analyzer/authtoken/login.json?token=X1BVQj0zZTM2YWE0MGVmMTEwMDM0NWQyZjg3MjVhOWE4ZDVhOSZzaXRlSWQ9YTNodUhkaVYzUFFhN0dxZyZfTk9XPTE1MzAwMDQxNzIzNTcmcHJvamVjdElkPUpldmY0Z2hhS1QwOTFyNUUmdXNlcklkPTEz

返回值示例:
{
    "header":
    {
        "code": 0,
        "message": null
    },
    "body":
    {
        "siteId": "a3huHdiV3PQa7Gqg",
        "userId": "13",
        "projectId": "Jevf4ghaKT091r5E"
    }
}
```

-------------

### 列举所有页面

* url:
    * ${HTTP_HOST}/analyzer/authtoken/data-manage/app-define/list-all-page.json
* method:
    * GET
* query params:
    * projectId 项目id 必传！
    * siteId 网站id 必传！
* 示例

```js
请求示例：
http://test.analyzer.datatist.cn/analyzer/authtoken/data-manage/app-define/list-all-page.json?projectId=Jevf4ghaKT091r5E&siteId=wXtuitgZ3ABGLDBr

返回值示例:
{
    "header":
    {
        "code": 0,
        "message": null
    },
    "body": [
    {
        "createTime": 1527752742000,
        "updateTime": 1527845350000,
        "id": 2,
        "projectId": "Jevf4ghaKT091r5E",
        …
    },
    {
        "createTime": 1527752742000,
        "updateTime": 1529650518000,
        "id": 15,
        "projectId": "Jevf4ghaKT091r5E",
        …
    }]
}

```

-------------

### 列举所有元素

* url:
    * ${HTTP_HOST}/analyzer/authtoken/data-manage/app-define/list-all-element.json
* method:
    * GET
* query params:
    * projectId 项目id 必传！
    * siteId 网站id 必传！
* 示例

```js
请求示例：
http://test.analyzer.datatist.cn/analyzer/authtoken/data-manage/app-define/list-all-element.json?projectId=Jevf4ghaKT091r5E&siteId=wXtuitgZ3ABGLDBr

返回值示例:
{
    "header":
    {
        "code": 0,
        "message": null
    },
    "body": [
    {
        "createTime": 1527752742000,
        "updateTime": 1527845350000,
        "id": 2,
        "projectId": "Jevf4ghaKT091r5E",
        …
    },
    {
        "createTime": 1527752742000,
        "updateTime": 1529650518000,
        "id": 15,
        "projectId": "Jevf4ghaKT091r5E",
        …
    }]
}
```

-------------

### 添加或修改元素

* url:
    * ${HTTP_HOST}/analyzer/authtoken/data-manage/app-define/define-element.json
* method:
    * POST
* post data:
    ```
    {
    	id: , // 如果非空，那么认为是更新操作
	    "projectId": , // 项目id
	    "siteId": , // 网站id
	    "eventAliasName": , // 事件名称
	    "domain": , // 所属页面
        "ignoreHref": ,//是否忽略链接
        "matchContent":, //是否匹配内容, //
        "matchPosition":, // 是否匹配位置

	    "element":
	    {
	        "id": , // 圈选元素的埋点id
	        "eId": , // 元素id
	        "eType": , // 元素类型
	        "eContent": , // 元素内容
	        "ePath": , // 路径
	        "ePosition": , // 元素位置
	        "snapShot": , // 截图
	        "href": // 元素链接
	    }
	}
	```
* 示例

```js

请求数据示例

{
    "projectId": "Jevf4ghaKT091r5E",
    "siteId": "wXtuitgZ3ABGLDBr",
    "eventAliasName": "事件131123114",
    "domain": "http://dddd.com",
    "ignoreHref": true,
    "matchContent":, false,
    "matchPosition": false,

    "element":
    {
        "id": "abcd1234123412341234",
        "eId": "abcd1234abcd1234",
        "eType": "button",
        "eContent": "button1",
        "ePath": "/div/button[1]",
        "ePosition": "1",
        "snapShot": "aaaaaaaxxxxx",
        "href": "http://www.datatist.com"
    }
}

```

### 列举已经定义的元素

* url:
    * ${HTTP_HOST}/analyzer/authtoken/data-manage/app-define/find-defined-elemennt.jso
* method:
    * GET
* query params:
    * projectId 项目id 必传！
    * siteId 网站id 必传！
    * url 所属页面url 不必传，不传则不判断
    * ePath 元素的path 不必传，不传则不判断
    * fatherEventId 不必传，不传则不判断
* 示例

```
http://test.analyzer.datatist.cn/analyzer/authtoken/data-manage/app-define/find-defined-elemennt.json?projectId=Jevf4ghaKT091r5E&siteId=wXtuitgZ3ABGLDBr&url=http://dddd.com&ePath=/div/button[1]&fatherEventId=0
```

### 列举所有页面

* url:
    * ${HTTP_HOST}
* method:
    *
* query params:
    *
* 示例

```
```

### 定义页面

* url:
    * ${HTTP_HOST}/analyzer/authtoken/data-manage/app-define/define-page.json
* method:
    * POST
* query params:
    ```
    {
      "id", // 页面id, 如果非空，那么认为是更新操作
	  "projectId": , // 项目id 必传！
	  "siteId": , // 网站id 必传！
	  "eventAliasName": , // 页面名称 必传!
	  "domain": , // 页面地址 必传!
	  "path": , // 页面路径
	  "query": , // 页面查询
	  "ignorePath": , // 是否忽略路径
	  "matchQuery":  // 匹配查询
	}
    ```
* 示例

```js
示例数据
{
  "projectId": "Jevf4ghaKT091r5E",
  "siteId": "wXtuitgZ3ABGLDBr",
  "eventAliasName": "页面1314566",
  "domain": "http://dddd.com",
  "path": "/abc",
  "query": "?abc=123",
  "ignorePath": true,
  "matchQuery": true
}
```

### 查找所有定义过的页面

* url:
    * ${HTTP_HOST}/analyzer/authtoken/data-manage/app-define/find-defined-page.json
* method:
    * GET
* query params:
    * projectId 项目id 必传！
    * siteId 网站id 必传！
    * domain 所属页面url 必传
    * path 页面查询 不必传，不传则不判断
    * query 页面查询 不必传，不传则不判断
* 示例

```js
http://test.analyzer.datatist.cn/analyzer/authtoken/data-manage/app-define/find-defined-page.json?projectId=Jevf4ghaKT091r5E&siteId=wXtuitgZ3ABGLDBr&domain=http://dddd.com&path=/abc&query=?abc=123
```
