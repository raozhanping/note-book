## 进程, 线程
**1. 进程和线程的区别**  

简而言之,一个程序至少有一个进程,一个进程至少有一个线程.   
线程的划分尺度小于进程，使得多线程程序的并发性高。  
另外，进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。  
线程在执行过程中与进程还是有区别的。每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。  
从逻辑角度来看，多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。但操作系统并没有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配。这就是进程和线程的重要区别。  

进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动,进程是系统进行资源分配和调度的一个独立单位.  

线程是进程的一个实体,是CPU调度和分派的基本单位,他是比进程更小的独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源.  

一个线程可以创建和撤销另一个线程;同一个进程中的多个线程之间可以并发执行.  

**主要差别:**  

**进程和线程的主要差别在于它们是不同的操作系统资源管理方式。进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个线程死掉就等于整个进程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。但对于一些要求同时进行并且又要共享某些变量的并发操作，只能用线程，不能用进程。如果有兴趣深入的话，我建议你们看看《现代操作系统》或者《操作系统的设计与实现》。对就个问题说得比较清楚。**

**2. 简介**  

进程（process）是一块包含了某些资源的内存区域。操作系统利用进程把它的工作划分为一些功能单元。  

**进程** 中所**包含的一个或多个执行单元称为线程（thread）**。进程还拥有一个私有的虚拟地址空间，该空间仅能被它所包含的线程访问。  

当运行.NET程序时，进程还会把被称为CLR的软件层包含到它的内存空间中。上一章曾经对CLR做了详细描述。该软件层是在进程创建期间由运行时宿主载入的（参见4.2.3节）。  

线程只能归属于一个进程并且它只能访问该进程所拥有的资源。当操作系统创建一个进程后，该进程会自动申请一个名为主线程或首要线程的线程。主线程将执行运行时宿主, 而运行时宿主会负责载入CLR。  

*应用程序（application）*是由 **一个或多个相互协作的进程组成的**。例如，Visual Studio开发环境就是利用一个进程编辑源文件，并利用另一个进程完成编译工作的应用程序。  

在Windows NT/2000/XP操作系统下，我们可以通过任务管理器在任意时间查看所有的应用程序和进程。尽管只打开了几个应用程序，但是通常情况下将有大约30个进程同时运行。 事实上，为了管理当前的会话和任务栏以及其他一些任务，系统执行了大量的进程。  

**3. 进程**  
**3.1 简介**  

在运行于32位处理器上的32位Windows操作系统中，可将一个进程视为一段大小为4GB（232字节）的线性内存空间，它起始于0x00000000结束于0xFFFFFFFF。这段内存空间不能被其他进程所访问，所以称为该进程的私有空间。这段空间被平分为两块，2GB被系统所有，剩下2GB被用户所有。  

如果有N个进程运行在同一台机器上，那么将需要N×4GB的海量RAM，还好事实并非如此。  

Windows是按需为每个进程分配内存的，4GB是32位系统中一个进程所占空间的上限。  
将进程所需的内存划分为4KB大小的内存页，并根据使用情况将这些内存页存储在硬盘上或加载到RAM中，通过系统的这种虚拟内存机制，我们可以有效地减少对实际内存的需求量。当然这些对用户和开发者来说都是透明的。  

**3.2 System.Diagnostics.Process 类**  
System.Diagnostics.Process类的实例可以引用一个进程，被引用的进程包含以下几种。  
1. 该实例的当前进程。
2. 本机上除了当前进程的其他进程。
3. 远程机器上的某个进程。
通过该类所包含的方法和字段，可以创建或销毁一个进程，并且可以获得一个进程的相关信息。下面将讨论一些使用该类实现的常见任务。  
默认情况下，子进程将继承其父进程的安全上下文。但还可以使用Process.Start()方法的一个重载版本在任意用户的安全上下文中启动该子进程，当然需要通过一个System.Diagnostics. ProcessStartInfo类的实例来提供该用户的用户名和密码  

**3.3 避免在一台机器上同时运行同一应用程序的多个实例**  

有些应用程序需要这种功能。实际上，通常来说在同一台机器上同时运行一个应用程序的多个实例并没有意义。  

直到现在，为了在Windows下满足上述约束，开发者最常用的方法仍然是使用有**名互斥体（named mutex）技术**（参见5.7.2节）。然而采用这种技术来满足上述约束存在以下缺点：  
1. 该技术具有使互斥体的名字被其他应用程序所使用的较小的、潜在的风险。在这种情况下该技术将不再有效并且会造成很难检测到的bug。
2. 该技术不能解决我们仅允许一个应用程序产生N个实例这种一般的问题。

幸而在System.Diagnostics.Process类中拥有**GetCurrentProcess()（返回当前进程）**和 **GetProcesses()（返回机器上所有的进程）**这样的静态方法.  

**4. 线程**  
**4.1 简介**  

一个线程包含以下内容:  

1. 一个指向当前被执行指令的指令指针；
2. 一个栈；
3. 一个寄存器值的集合，定义了一部分描述正在执行线程的处理器状态的值；
4. 一个私有的数据区。

所有这些元素都归于线程执行上下文的名下。处在同一个进程中的所有线程都可以访问该进程所包含的地址空间，当然也包含存储在该空间中的所有资源。  

**4.2 受托管的线程与 Windows线程**  

**4.3 抢占式多任务处理**  

**4.3 进程与线程的优先级**  

### 进程,线程

操作系统的设计，因此可以归结为三点：  
1. 以多进程形式，允许多个任务同时运行；
2. 以多线程形式，允许单个任务分成不同的部分运行；
3. 提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源。

进程状态：进程有三个状态，就绪，运行和阻塞。  